using System;

namespace NLDB
{
    /// <summary>
    /// Класс для быстрой работы с простыми числами. Хранит в памяти некоторое количество (MaxIndex) простых чисел, 
    /// вычисленных с определенным шагом
    /// </summary>
    public static class Primes
    {
        public static readonly int BitsPerStep = 16;
        public static readonly int MaxIndex = 1023;        //Максимальный индекс в массиве простых чисел
        public static readonly int MinPrime = 64513;       //Мнимальное число в массиве (values[0])
        public static readonly int MaxPrime = 67107863;    //Максимальное число в массиве (values[1023])
        public static readonly int SegmentSize = 1 << BitsPerStep;     //шаг, с которым вычислялись простые числа

        //Простые числа с шагом 2^BitsPerStep
        private static readonly int[] values = new int[1024]
        {
            64513,130051,195593,261127,326657,392201,457739,523297,588811,654343,719893,785413,850951,916501,982021,1047559,1113089,1178633,1244167,1309699,1375237,1440773,1506317,1571849,1637381,1702927,1768471,1834031,1899523,1965077,2030617,2096147,2161697,2227201,2292737,2358283,2423821,2489371,2554891,2620417,2685959,2751493,2817029,2882599,2948119,3013639,3079189,3144707,3210253,3275803,3341323,3406853,3472387,3537943,3603469,3668999,3734531,3800081,3865601,3931159,3996743,4062221,4127749,4193297,4258819,4324363,4389899,4455461,4520983,4586531,4652099,4717571,4783109,4848643,4914187,4979713,5045251,5110801,5176321,5241857,5307397,5372929,5438479,5504017,5569559,5635103,5700623,5766161,5831687,5897219,5962763,6028289,6093853,6159367,6224909,6290441,6355997,6421507,6487049,6552593,6618113,6683689,6749191,6814729,6880259,6945803,7011353,7076869,7142413,7207957,7273477,7339027,7404563,7470103,7535617,7601177,7666693,7732261,7797763,7863301,7928849,7994377,8059937,8125457,8190979,8256541,8322121,8387591,8453141,8518661,8584193,8649757,8715269,8780813,8846353,8911901,8977433,9042949,9108487,9174029,9239563,9305089,9370643,9436169,9501719,9567269,9632771,9698321,9763841,9829399,9894919,9960463,10026011,10091531,10157071,10222601,10288141,10353691,10419209,10484737,10550273,10615817,10681369,10746881,10812419,10877953,10943489,11009027,11074561,11140111,11205637,11271181,11336707,11402243,11467783,11533321,11598887,11664407,11729923,11795461,11860993,11926529,11992067,12057611,12123151,12188681,12254213,12319753,12385297,12450847,12516373,12581903,12647477,12712963,12778499,12844049,12909583,12975113,13040659,13106209,13171721,13237261,13302797,13368353,13433867,13499399,13564931,13630469,13696019,13761541,13827101,13892617,13958149,14023727,14089247,14154779,14220293,14285837,14351371,14416903,14482441,14547979,14613539,14679043,14744581,14810141,14875673,14941187,15006721,15072259,15137831,15203329,15268871,15334409,15399947,15465481,15531011,15596563,15662089,15727639,15793177,15858743,15924239,15989777,16055309,16120883,16186381,16251913,16317443,16382981,16448513,16514053,16579613,16645129,16710679,16776211,16841761,16907273,16972819,17038361,17103901,17169457,17234953,17300527,17366021,17431571,17497111,17562653,17628161,17693699,17759233,17824769,17890321,17955853,18021379,18086933,18152461,18217993,18283541,18349063,18414611,18480167,18545687,18611207,18676769,18742277,18807821,18873419,18938891,19004429,19069987,19135507,19201033,19266601,19332109,19397683,19463177,19528709,19594241,19659781,19725313,19790861,19856401,19921921,19987469,20052997,20118533,20184067,20249633,20315143,20380681,20446213,20511749,20577281,20642821,20708377,20773901,20839451,20904971,20970511,21036061,21101569,21167117,21232663,21298177,21363739,21429257,21494789,21560321,21625889,21691403,21756949,21822473,21888007,21953537,22019089,22084613,22150157,22215689,22281221,22346783,22412297,22477837,22543393,22608907,22674437,22739987,22805507,22871063,22936577,23002117,23067661,23133191,23198729,23264273,23329793,23395343,23460881,23526407,23591941,23657477,23723009,23788553,23854093,23919617,23985161,24050707,24116227,24181789,24247309,24312833,24378371,24443927,24509473,24575077,24640513,24706069,24771587,24837121,24902693,24968197,25033733,25099271,25164803,25230341,25295903,25361417,25426957,25492483,25558051,25623557,25689089,25754657,25820209,25885703,25951253,26016773,26082311,26147851,26213381,26278913,26344463,26410009,26475529,26541059,26606597,26672207,26737729,26803201,26868763,26934277,26999813,27065347,27130897,27196427,27261967,27327493,27393049,27458569,27524111,27589633,27655211,27720739,27786247,27851783,27917339,27982849,28048399,28113923,28179467,28245031,28310561,28376083,28441607,28507159,28572679,28638209,28703761,28769291,28834831,28900363,28965913,29031437,29096981,29162503,29228033,29293597,29359111,29424649,29490179,29555723,29621257,29686793,29752351,29817869,29883401,29948953,30014497,30080009,30145561,30211079,30276637,30342157,30407681,30473227,30538787,30604319,30669827,30735391,30800899,30866477,30931973,30997523,31063051,31128583,31194127,31259659,31325197,31390727,31456259,31521793,31587341,31652903,31718417,31783957,31849501,31915019,31980551,32046089,32111617,32177177,32242723,32308249,32373767,32439413,32504837,32570383,32635913,32701441,32766983,32832517,32898067,32963587,33029131,33094657,33160199,33225749,33291277,33356833,33422341,33487877,33553417,33618953,33684481,33750037,33815557,33881101,33946631,34012171,34077721,34143233,34208773,34274323,34339841,34405379,34470913,34536451,34601999,34667531,34733063,34798601,34864133,34929673,34995217,35060737,35126293,35191823,35257373,35322893,35388449,35453953,35519513,35585041,35650561,35716111,35781637,35847173,35912719,35978287,36043807,36109313,36174857,36240397,36305933,36371477,36436993,36502537,36568069,36633607,36699163,36764701,36830237,36895753,36961319,37026851,37092361,37157899,37223441,37288991,37354501,37420049,37485571,37551131,37616641,37682189,37747729,37813261,37878811,37944331,38009879,38075417,38140931,38206499,38272001,38337539,38403073,38468621,38534159,38599703,38665229,38730763,38796293,38861833,38927363,38992901,39058463,39123971,39189541,39255053,39320579,39386131,39451667,39517201,39582721,39648277,39713797,39779357,39844867,39910411,39975937,40041473,40107013,40172549,40238087,40303621,40369171,40434697,40500241,40565761,40631351,40696847,40762369,40827947,40893487,40959007,41024539,41090051,41155591,41221123,41286671,41352203,41417759,41483279,41548811,41614367,41679899,41745409,41810947,41876507,41942023,42007571,42073091,42138647,42204179,42269707,42335233,42400793,42466331,42531887,42597407,42662941,42728471,42793991,42859529,42925063,42990593,43056133,43121699,43187231,43252739,43318279,43383811,43449353,43514881,43580437,43645969,43711489,43777033,43842581,43908119,43973639,44039179,44104721,44170289,44235799,44301319,44366863,44432411,44497933,44563481,44629001,44694541,44760071,44825603,44891137,44956693,45022213,45087781,45153281,45218819,45284389,45349891,45415459,45480977,45546511,45612107,45677587,45743153,45808643,45874181,45939713,46005263,46070789,46136323,46201877,46267399,46332943,46398467,46464013,46529573,46595093,46660619,46726159,46791691,46857227,46922767,46988309,47053843,47119361,47184899,47250449,47315969,47381507,47447077,47512589,47578117,47643653,47709197,47774729,47840257,47905811,47971361,48036889,48102419,48167939,48233473,48299029,48364549,48430121,48495617,48561187,48626723,48692239,48757799,48823297,48888839,48954371,49019909,49085447,49150987,49216543,49282073,49347593,49413151,49478659,49544197,49609733,49675267,49740811,49806347,49871923,49937411,50002951,50068507,50134033,50199557,50265119,50330629,50396179,50461709,50527259,50592769,50658319,50723899,50789381,50854913,50920453,50985997,51051523,51117083,51182603,51248129,51313697,51379201,51444749,51510299,51575809,51641347,51706883,51772421,51837953,51903541,51969059,52034573,52100101,52165637,52231169,52296731,52362259,52427857,52493317,52558859,52624399,52689937,52755503,52821017,52886567,52952077,53017603,53083139,53148691,53214209,53279767,53345291,53410817,53476387,53541893,53607439,53672981,53738501,53804033,53869591,53935127,54000643,54066193,54131713,54197279,54262801,54328327,54393869,54459401,54524971,54590467,54656009,54721543,54787087,54852617,54918163,54983683,55049231,55114771,55180297,55245829,55311367,55376903,55442459,55508003,55573579,55639043,55704581,55770173,55835693,55901203,55966721,56032267,56097863,56163329,56228881,56294417,56359937,56425477,56491031,56556547,56622103,56687629,56753161,56818787,56884237,56949769,57015307,57080833,57146429,57211909,57277453,57342977,57408551,57474077,57539593,57605143,57670661,57736201,57801749,57867301,57932827,57998359,58063877,58129411,58194959,58260487,58326019,58391581,58457107,58522657,58588183,58653709,58719233,58784779,58850333,58915853,58981399,59046941,59112463,59178001,59243531,59309057,59374597,59440141,59505703,59571229,59636737,59702287,59767817,59833357,59898899,59964439,60029989,60095489,60161027,60226571,60292103,60357643,60423179,60488711,60554243,60619799,60685327,60750871,60816401,60881929,60947483,61013033,61078529,61144099,61209607,61275143,61340689,61406209,61471747,61537283,61602833,61668389,61733933,61799443,61864961,61930511,61996043,62061661,62127113,62192653,62258177,62323757,62389291,62454811,62520379,62585863,62651483,62716933,62782483,62848003,62913547,62979089,63044609,63110207,63175691,63241231,63306757,63372317,63437831,63503371,63568903,63634433,63699971,63765529,63831109,63896579,63962131,64027651,64093187,64158737,64224263,64289803,64355341,64420903,64486421,64551943,64617491,64683023,64748609,64814083,64879627,64945163,65010691,65076227,65141761,65207299,65272841,65338393,65403907,65469451,65534993,65600537,65666057,65731591,65797129,65862661,65928197,65993729,66059269,66124811,66190337,66255881,66321421,66386951,66452527,66518057,66583571,66649103,66714671,66780209,66845711,66911233,66976769,67042307,67107863
        };

        //
        public static int NextPrime(int n)
        {
            int i = n >> BitsPerStep;
            if (i > MaxIndex) throw new ArgumentOutOfRangeException($"Значение параметра не может превосходить число {MaxPrime}");
            return values[i];
        }
    }
}
